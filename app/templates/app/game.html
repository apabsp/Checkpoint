{% extends 'app/layout.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'root/styles/style.css' %}">
    <link rel="stylesheet" href="{% static 'app/styles/app.css' %}">
    <link rel="stylesheet" href="{% static 'app/styles/game.css' %}">
{% endblock %}

{% block body %}
    <div class="container-game">
        <div>
            <img src="{{ game.image }}" alt="">
            <div>
                <button id="like">
                    <svg class="{{ liked }}" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>
                    {{ likes }}
                </button>
                <div>
                    avaliar
                </div>
            </div>
        </div>
        <div>
            <h1>{{ game.name }}</h1>
            <div class = "review"> 
                <form action = "{% url 'app:submit_review' id=game.id %}" method="post"> 
                    {% csrf_token %}
                    {{reviewText}}
                    <textarea name="textoDaReview" class="reviewText"></textarea> <!--TENHO QUE JOGAR ESSE REVIEW TEXT NO MEU POST!!!! para registrar-->
                    <button class = "boataoReview" type="submit" value = "cadastrar">oh my god the button</button>
                </form>
            </div> 
        </div>
    </div>

{% endblock %}

{% block script %}
    <script>
        function getCSRFToken() {
            var cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                var cookies = document.cookie.split(";");
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    if (cookie.substring(0, 10) === "csrftoken=") {
                        cookieValue = decodeURIComponent(cookie.substring(10));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        document.getElementById("like").addEventListener("click", async () => {
            const res = await fetch("/app/game/{{game.id}}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": getCSRFToken()
                }
            })
            const data = await res.json();
            
            alert(data.message.concat(" {{ game.name }}"));

            if(res.ok) {
                window.location.reload();
            }
        })
    </script>
{% endblock %}