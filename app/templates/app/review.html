{% extends 'app/layout.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'root/styles/style.css' %}">
    <link rel="stylesheet" href="{% static 'app/styles/app.css' %}">
    <link rel="stylesheet" href="{% static 'app/styles/review.css' %}">
    <link rel="stylesheet" href="{% static 'root/styles/toast.css' %}">
{% endblock %}

{% block body %}
    <div class="container-content">
        <div>
            <img src="{{ game.image }}" alt="{{game.name}}">
        </div>

        <div class="container-review">
            <h1>{{ game.name }}</h1>
            <div class="review">

                <form class="review" action="" method="post">
                    {% csrf_token %}
                    <input id="review-text" type="text" name="review-text" value="{{review.text}}" disabled>
                    <input type="hidden" value="edit" name="action">
                    <button type="button" id="edit-review">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pen-line">
                            <path d="M12 20h9"/>
                            <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                        </svg>
                    </button>
                </form>

                {% if user.username == reviewCreator.username %}
                    <form action="" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="review_id" value="{{ review_id }}">
                        <input type="hidden" value="delete" name="action">
                        <button type="submit" id="delete-review">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-trash-2">
                                <path d="M3 6h18" />
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                <line x1="10" x2="10" y1="11" y2="17" />
                                <line x1="14" x2="14" y1="11" y2="17" />
                            </svg>
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="toast">
                <p>{{message}}</p>
            </div>
        {% endfor %}
    {% endif %}

{% endblock %}

{% block script %}
    <script>
        const editButton = document.getElementById("edit-review");
        const reviewContent = document.getElementById("review-text");

        editButton.addEventListener("click", () => {
            reviewContent.disabled = false;
            reviewContent.focus();
            reviewContent.select();

            setTimeout(() => {
                editButton.type = "submit";

                editButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"/><path d="M7 3v4a1 1 0 0 0 1 1h7"/></svg>`
            }, 1);
        });
    </script>
{% endblock %}